define("parsley/ui",["parsley/utils"],function(){var e=function(){this.__class__="ParsleyUI"};return e.prototype={listen:function(){return $.listen("parsley:form:init",this,this.setupForm),$.listen("parsley:field:init",this,this.setupField),$.listen("parsley:field:validated",this,this.reflow),$.listen("parsley:form:validated",this,this.focus),$.listen("parsley:field:reset",this,this.reset),$.listen("parsley:form:destroy",this,this.destroy),$.listen("parsley:field:destroy",this,this.destroy),this},reflow:function(e){if("undefined"!=typeof e._ui&&!1!==e._ui.active){var s=this._diff(e.validationResult,e._ui.lastValidationResult);e._ui.lastValidationResult=e.validationResult,e._ui.validatedOnce=!0,this.manageStatusClass(e),this.manageErrorsMessages(e,s),this.actualizeTriggers(e),(s.kept.length||s.added.length)&&"undefined"==typeof e._ui.failedOnce&&this.manageFailingFieldTrigger(e)}},getErrorsMessages:function(e){if(!0===e.validationResult)return[];for(var s=[],r=0;r<e.validationResult.length;r++)s.push(this._getErrorMessage(e,e.validationResult[r].assert));return s},manageStatusClass:function(e){!0===e.validationResult?this._successClass(e):e.validationResult.length>0?this._errorClass(e):this._resetClass(e)},manageErrorsMessages:function(e,s){if("undefined"==typeof e.options.errorsMessagesDisabled){if("undefined"!=typeof e.options.errorMessage)return s.added.length||s.kept.length?(0===e._ui.$errorsWrapper.find(".parsley-custom-error-message").length&&e._ui.$errorsWrapper.append($(e.options.errorTemplate).addClass("parsley-custom-error-message")),e._ui.$errorsWrapper.addClass("filled").find(".parsley-custom-error-message").html(e.options.errorMessage)):e._ui.$errorsWrapper.removeClass("filled").find(".parsley-custom-error-message").remove();for(var r=0;r<s.removed.length;r++)this.removeError(e,s.removed[r].assert.name,!0);for(r=0;r<s.added.length;r++)this.addError(e,s.added[r].assert.name,void 0,s.added[r].assert,!0);for(r=0;r<s.kept.length;r++)this.updateError(e,s.kept[r].assert.name,void 0,s.kept[r].assert,!0)}},addError:function(e,s,r,t,i){e._ui.$errorsWrapper.addClass("filled").append($(e.options.errorTemplate).addClass("parsley-"+s).html(r||this._getErrorMessage(e,t))),!0!==i&&this._errorClass(e)},updateError:function(e,s,r,t,i){e._ui.$errorsWrapper.addClass("filled").find(".parsley-"+s).html(r||this._getErrorMessage(e,t)),!0!==i&&this._errorClass(e)},removeError:function(e,s,r){e._ui.$errorsWrapper.removeClass("filled").find(".parsley-"+s).remove(),!0!==r&&this.manageStatusClass(e)},focus:function(e){if(!0===e.validationResult||"none"===e.options.focus)return e._focusedField=null;e._focusedField=null;for(var s=0;s<e.fields.length;s++)if(!0!==e.fields[s].validationResult&&e.fields[s].validationResult.length>0&&"undefined"==typeof e.fields[s].options.noFocus){if("first"===e.options.focus)return e._focusedField=e.fields[s].$element,e._focusedField.focus();e._focusedField=e.fields[s].$element}return null===e._focusedField?null:e._focusedField.focus()},_getErrorMessage:function(e,s){var r=s.name+"Message";return"undefined"!=typeof e.options[r]?window.ParsleyValidator.formatMessage(e.options[r],s.requirements):window.ParsleyValidator.getErrorMessage(s)},_diff:function(e,s,r){for(var t=[],i=[],n=0;n<e.length;n++){for(var a=!1,o=0;o<s.length;o++)if(e[n].assert.name===s[o].assert.name){a=!0;break}a?i.push(e[n]):t.push(e[n])}return{kept:i,added:t,removed:r?[]:this._diff(s,e,!0).added}},setupForm:function(e){e.$element.on("submit.Parsley",!1,$.proxy(e.onSubmitValidate,e)),!1!==e.options.uiEnabled&&e.$element.attr("novalidate","")},setupField:function(e){var s={active:!1};!1!==e.options.uiEnabled&&(s.active=!0,e.$element.attr(e.options.namespace+"id",e.__id__),s.$errorClassHandler=this._manageClassHandler(e),s.errorsWrapperId="parsley-id-"+("undefined"!=typeof e.options.multiple?"multiple-"+e.options.multiple:e.__id__),s.$errorsWrapper=$(e.options.errorsWrapper).attr("id",s.errorsWrapperId),s.lastValidationResult=[],s.validatedOnce=!1,s.validationInformationVisible=!1,e._ui=s,e.$element.is(e.options.excluded)||this._insertErrorWrapper(e),this.actualizeTriggers(e))},_manageClassHandler:function(e){if("string"==typeof e.options.classHandler&&$(e.options.classHandler).length)return $(e.options.classHandler);var s=e.options.classHandler(e);return"undefined"!=typeof s&&s.length?s:"undefined"==typeof e.options.multiple||e.$element.is("select")?e.$element:e.$element.parent()},_insertErrorWrapper:function(e){var s;if("string"==typeof e.options.errorsContainer){if($(e.options.errorsContainer).length)return $(e.options.errorsContainer).append(e._ui.$errorsWrapper);window.console&&window.console.warn&&window.console.warn("The errors container `"+e.options.errorsContainer+"` does not exist in DOM")}else"function"==typeof e.options.errorsContainer&&(s=e.options.errorsContainer(e));return"undefined"!=typeof s&&s.length?s.append(e._ui.$errorsWrapper):"undefined"==typeof e.options.multiple?e.$element.after(e._ui.$errorsWrapper):e.$element.parent().after(e._ui.$errorsWrapper)},actualizeTriggers:function(e){var s=e.$element;if(e.options.multiple&&(s=$("["+e.options.namespace+'multiple="'+e.options.multiple+'"]')),s.off(".Parsley"),!1!==e.options.trigger){var r=e.options.trigger.replace(/^\s+/g,"").replace(/\s+$/g,"");""!==r&&s.on(r.split(" ").join(".Parsley ")+".Parsley",$.proxy("function"==typeof e.eventValidate?e.eventValidate:this.eventValidate,e))}},eventValidate:function(e){new RegExp("key").test(e.type)&&!this._ui.validationInformationVisible&&this.getValue().length<=this.options.validationThreshold||(this._ui.validatedOnce=!0,this.validate())},manageFailingFieldTrigger:function(e){return e._ui.failedOnce=!0,e.options.multiple&&$("["+e.options.namespace+'multiple="'+e.options.multiple+'"]').each(function(){return new RegExp("change","i").test($(this).parsley().options.trigger||"")?void 0:$(this).on("change.ParsleyFailedOnce",!1,$.proxy(e.validate,e))}),e.$element.is("select")&&!new RegExp("change","i").test(e.options.trigger||"")?e.$element.on("change.ParsleyFailedOnce",!1,$.proxy(e.validate,e)):new RegExp("keyup","i").test(e.options.trigger||"")?void 0:e.$element.on("keyup.ParsleyFailedOnce",!1,$.proxy(e.validate,e))},reset:function(e){e.$element.off(".Parsley"),e.$element.off(".ParsleyFailedOnce"),"undefined"!=typeof e._ui&&"ParsleyForm"!==e.__class__&&(e._ui.$errorsWrapper.removeClass("filled").children().remove(),this._resetClass(e),e._ui.validatedOnce=!1,e._ui.lastValidationResult=[],e._ui.validationInformationVisible=!1)},destroy:function(e){this.reset(e),"ParsleyForm"!==e.__class__&&("undefined"!=typeof e._ui&&e._ui.$errorsWrapper.remove(),delete e._ui)},_successClass:function(e){e._ui.validationInformationVisible=!0,e._ui.$errorClassHandler.removeClass(e.options.errorClass).addClass(e.options.successClass)},_errorClass:function(e){e._ui.validationInformationVisible=!0,e._ui.$errorClassHandler.removeClass(e.options.successClass).addClass(e.options.errorClass)},_resetClass:function(e){e._ui.$errorClassHandler.removeClass(e.options.successClass).removeClass(e.options.errorClass)}},e});