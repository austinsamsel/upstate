define("parsley/field",["parsley/factory/constraint","parsley/ui","parsley/utils"],function(t,i,n){var e=function(t,i,e){this.__class__="ParsleyField",this.__id__=n.hash(4),this.$element=$(t),"undefined"!=typeof e?(this.parent=e,this.OptionsFactory=this.parent.OptionsFactory,this.options=this.OptionsFactory.get(this)):(this.OptionsFactory=i,this.options=this.OptionsFactory.get(this)),this.constraints=[],this.constraintsByName={},this.validationResult=[],this._bindConstraints()};return e.prototype={validate:function(t){return this.value=this.getValue(),$.emit("parsley:field:validate",this),$.emit("parsley:field:"+(this.isValid(t,this.value)?"success":"error"),this),$.emit("parsley:field:validated",this),this.validationResult},isValid:function(t,i){this.refreshConstraints();var n=this._getConstraintsSortedPriorities();if(0===n.length)return this.validationResult=[];if(("undefined"==typeof i||null===i)&&(i=this.getValue()),!i.length&&!this._isRequired()&&"undefined"==typeof this.options.validateIfEmpty&&!0!==t)return this.validationResult=[];if(!1===this.options.priorityEnabled)return!0===(this.validationResult=this.validateThroughValidator(i,this.constraints,"Any"));for(var e=0;e<n.length;e++)if(!0!==(this.validationResult=this.validateThroughValidator(i,this.constraints,n[e])))return!1;return!0},getValue:function(){var t;return t="undefined"!=typeof this.options.value?this.options.value:this.$element.val(),"undefined"==typeof t||null===t?"":!0===this.options.trimValue?t.replace(/^\s+|\s+$/g,""):t},refreshConstraints:function(){return this.actualizeOptions()._bindConstraints()},addConstraint:function(i,n,e,s){if(i=i.toLowerCase(),"function"==typeof window.ParsleyValidator.validators[i]){var a=new t(this,i,n,e,s);"undefined"!==this.constraintsByName[a.name]&&this.removeConstraint(a.name),this.constraints.push(a),this.constraintsByName[a.name]=a}return this},removeConstraint:function(t){for(var i=0;i<this.constraints.length;i++)if(t===this.constraints[i].name){this.constraints.splice(i,1);break}return delete this.constraintsByName[t],this},updateConstraint:function(t,i,n){return this.removeConstraint(t).addConstraint(t,i,n)},_bindConstraints:function(){for(var t=[],i={},n=0;n<this.constraints.length;n++)!1===this.constraints[n].isDomConstraint&&(t.push(this.constraints[n]),i[this.constraints[n].name]=this.constraints[n]);this.constraints=t,this.constraintsByName=i;for(var e in this.options)this.addConstraint(e,this.options[e]);return this._bindHtml5Constraints()},_bindHtml5Constraints:function(){(this.$element.hasClass("required")||this.$element.attr("required"))&&this.addConstraint("required",!0,void 0,!0),"string"==typeof this.$element.attr("pattern")&&this.addConstraint("pattern",this.$element.attr("pattern"),void 0,!0),"undefined"!=typeof this.$element.attr("min")&&"undefined"!=typeof this.$element.attr("max")?this.addConstraint("range",[this.$element.attr("min"),this.$element.attr("max")],void 0,!0):"undefined"!=typeof this.$element.attr("min")?this.addConstraint("min",this.$element.attr("min"),void 0,!0):"undefined"!=typeof this.$element.attr("max")&&this.addConstraint("max",this.$element.attr("max"),void 0,!0),"undefined"!=typeof this.$element.attr("minlength")&&"undefined"!=typeof this.$element.attr("maxlength")?this.addConstraint("length",[this.$element.attr("minlength"),this.$element.attr("maxlength")],void 0,!0):"undefined"!=typeof this.$element.attr("minlength")?this.addConstraint("minlength",this.$element.attr("minlength"),void 0,!0):"undefined"!=typeof this.$element.attr("maxlength")&&this.addConstraint("maxlength",this.$element.attr("maxlength"),void 0,!0);var t=this.$element.attr("type");return"undefined"==typeof t?this:"number"===t?"undefined"==typeof this.$element.attr("step")||0===parseFloat(this.$element.attr("step"))%1?this.addConstraint("type","integer",void 0,!0):this.addConstraint("type","number",void 0,!0):new RegExp(t,"i").test("email url range")?this.addConstraint("type",t,void 0,!0):this},_isRequired:function(){return"undefined"==typeof this.constraintsByName.required?!1:!1!==this.constraintsByName.required.requirements},_getConstraintsSortedPriorities:function(){for(var t=[],i=0;i<this.constraints.length;i++)-1===t.indexOf(this.constraints[i].priority)&&t.push(this.constraints[i].priority);return t.sort(function(t,i){return i-t}),t}},e});