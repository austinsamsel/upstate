define(["parsley/utils","parsley/defaults","parsley/abstract","parsley/validator","parsley/ui","parsley/factory/options","parsley/form","parsley/field","parsley/multiple","parsley/pubsub","i18n/en"],function(e,t,i,n,s,a,l,o,r){var p=function(t,i,n){if(this.__class__="Parsley",this.__version__="@@version",this.__id__=e.hash(4),"undefined"==typeof t)throw new Error("You must give an element");if("undefined"!=typeof n&&"ParsleyForm"!==n.__class__)throw new Error("Parent instance must be a ParsleyForm instance");return this.init($(t),i,n)};return p.prototype={init:function(i,n,s){if(!i.length)throw new Error("You must bind Parsley on an existing element.");if(this.$element=i,this.$element.data("Parsley")){var l=this.$element.data("Parsley");return"undefined"!=typeof s&&(l.parent=s),l}return this.OptionsFactory=new a(t,e.get(window,"ParsleyConfig")||{},n,this.getNamespace(n)),this.options=this.OptionsFactory.get(this),this.$element.is("form")||e.attr(this.$element,this.options.namespace,"validate")&&!this.$element.is(this.options.inputs)?this.bind("parsleyForm"):this.$element.is(this.options.inputs)&&!this.$element.is(this.options.excluded)?this.isMultiple()?this.handleMultiple(s):this.bind("parsleyField",s):this},isMultiple:function(){return this.$element.is("input[type=radio], input[type=checkbox]")&&"undefined"==typeof this.options.multiple||this.$element.is("select")&&"undefined"!=typeof this.$element.attr("multiple")},handleMultiple:function(t){var i,n,s,a=this;if(this.options=$.extend(this.options,t?t.OptionsFactory.get(t):{},e.attr(this.$element,this.options.namespace)),this.options.multiple?n=this.options.multiple:"undefined"!=typeof this.$element.attr("name")&&this.$element.attr("name").length?n=i=this.$element.attr("name"):"undefined"!=typeof this.$element.attr("id")&&this.$element.attr("id").length&&(n=this.$element.attr("id")),this.$element.is("select")&&"undefined"!=typeof this.$element.attr("multiple"))return this.bind("parsleyFieldMultiple",t,n||this.__id__);if("undefined"==typeof n)return window.console&&window.console.warn&&window.console.warn("To be binded by Parsley, a radio, a checkbox and a multiple select input must have either a name or a multiple option.",this.$element),this;if(n=n.replace(/(:|\.|\[|\]|\{|\}|\$)/g,""),"undefined"!=typeof i&&$('input[name="'+i+'"]').each(function(){$(this).is("input[type=radio], input[type=checkbox]")&&$(this).attr(a.options.namespace+"multiple",n)}),$("["+this.options.namespace+"multiple="+n+"]").length)for(var l=0;l<$("["+this.options.namespace+"multiple="+n+"]").length;l++)if("undefined"!=typeof $($("["+this.options.namespace+"multiple="+n+"]").get(l)).data("Parsley")){s=$($("["+this.options.namespace+"multiple="+n+"]").get(l)).data("Parsley"),this.$element.data("ParsleyFieldMultiple")||(s.addElement(this.$element),this.$element.attr(this.options.namespace+"id",s.__id__));break}return this.bind("parsleyField",t,n,!0),s||this.bind("parsleyFieldMultiple",t,n)},getNamespace:function(i){return"undefined"!=typeof this.$element.data("parsleyNamespace")?this.$element.data("parsleyNamespace"):"undefined"!=typeof e.get(i,"namespace")?i.namespace:"undefined"!=typeof e.get(window,"ParsleyConfig.namespace")?window.ParsleyConfig.namespace:t.namespace},bind:function(t,n,s,a){var p;switch(t){case"parsleyForm":p=$.extend(new l(this.$element,this.OptionsFactory),new i,window.ParsleyExtend)._bindFields();break;case"parsleyField":p=$.extend(new o(this.$element,this.OptionsFactory,n),new i,window.ParsleyExtend);break;case"parsleyFieldMultiple":p=$.extend(new o(this.$element,this.OptionsFactory,n),new i,new r,window.ParsleyExtend)._init(s);break;default:throw new Error(t+"is not a supported Parsley type")}return"undefined"!=typeof s&&e.setAttr(this.$element,this.options.namespace,"multiple",s),"undefined"!=typeof a?(this.$element.data("ParsleyFieldMultiple",p),p):(new RegExp("ParsleyF","i").test(p.__class__)&&(this.$element.data("Parsley",p),$.emit("parsley:"+("parsleyForm"===t?"form":"field")+":init",p)),p)}},$.fn.parsley=$.fn.psly=function(e){if(this.length>1){var t=[];return this.each(function(){t.push($(this).parsley(e))}),t}return $(this).length?new p(this,e):void(window.console&&window.console.warn&&window.console.warn("You must bind Parsley on an existing element."))},window.ParsleyUI="function"==typeof e.get(window,"ParsleyConfig.ParsleyUI")?(new window.ParsleyConfig.ParsleyUI).listen():(new s).listen(),"undefined"==typeof window.ParsleyExtend&&(window.ParsleyExtend={}),"undefined"==typeof window.ParsleyConfig&&(window.ParsleyConfig={}),window.Parsley=window.psly=p,window.ParsleyUtils=e,window.ParsleyValidator=new n(window.ParsleyConfig.validators,window.ParsleyConfig.i18n),!1!==e.get(window,"ParsleyConfig.autoBind")&&$(function(){$("[data-parsley-validate]").length&&$("[data-parsley-validate]").parsley()}),p});